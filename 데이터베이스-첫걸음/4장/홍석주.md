# 데이터베이스와 아키텍처 구성

- 데이터베이스는 문제가 생겨 기능이 정지하면 인프라로써 역할을 못하기에 견고하게 유지되는 것이 관건
- 그렇기에 `다중화`에 대한 고려를 해야함

## 아키텍처

- 시스템을 만들기 위한 물리 레벨의 조합
- 어떤 기능을 가진 서버를 준비하고 어떠한 저장소나 네트워크 기기와 조합해서 시스템 전체를 만들 것인가 고려 (하드웨어 + 미들웨어)
- 아키텍처의 다음과 같은 변화를 가짐
  - Stand-alone (~1980년대)
    - 협업의 개념이 등장하기 전이라 LAN이나 인터넷 등의 네트워크에 접속하지 않고 독립되어 동작
    - 직접 설치된 곳에 가서 물리적으로 접근해야함
    - 복수 사용자가 동시에 접근할 수 없음
    - 가용성이 낮음
    - 확장성이 부족, 실제 머신이 1대기이기 때문에 성능을 올리려면 껐다켜야하고 이는 가용성이 낮아짐을 초래함
    - 대신, 구축이 간단하여 소규모 작업이나 테스트가 빠름
    - 물리적인 접근이 필요하기에 보안성이 높아 데이터를 도둑맞을 일은 없음
  - 클라이언트/서버(1990년대~2000년)
    - 네트워크 연결을 통해 원격으로 접근 가능 <-> 해킹의 위험이 높아져 보안이 취약해질 수 있음
    - 다중 사용자가 사용할 수 있음
    - 클라이언트에서의 애플리케이션 관리비용이 많이 들게 됨 (각각 환경에 맞게 대응해야 함 -> 비즈니스 코드 중구난방)
  - Web 3 게층 (2000년~현재)
    - 비즈니스 로직을 실행하는 애플리케이션 서버를 서버에서 관리해 비용을 절감
    - 웹 서버 계층/애플리케이션 계층/데이터베이스 계층으로 3 개의 계층으로 분류
    - 그래도 가용성 문제와 확장성 부족의 문제는 해결해야할 사안


## 가용성과 확장성의 확보

- 견고한 아키텍처 시스템은 가용성이 가장 중요함. 가용성을 높이즌 전략은 다음과 같음
  - 심장전략(꼬품질-소수전략): 시스템을 구성하는 각 컴포넌트의 신뢰성을 높여 장애 발생률을 낮게 억제해서 가용성 확보
  - 신장전략(저품질-다수전략): 시스템을 구성하는 각 컴포넌트의 신뢰성을 계속 높이기 보다. 여러 개를 만들어서 여분을 통해 가용성 확보
- 24시간/365일 무중단 시스템을 도모하기 위해선 `신장전략`을 많이 취하는 추새

### 클러스터

- 컴포넌트를 병렬화하는 것을 클러스터링이라고 함. 이를 위해선 동일한 기능의 컴포넌트를 복수 개 준비해 한 개의 기능을 실현하는 것임
- 서버를 여러 대 준비할 수록 가용성은 높아지지만 완전 100%는 존재하지 않는다.

## DB 서버 다중화 - 클러스터링

- DB 서버가 데이터를 보존하는 `영속` 계쯩이라 다중화에 특유의 어려움을 겪오 있다.
- 데이터는 항상 갱신되기 때문에 다중화를 유지하는 중에 `데이터 정합성`도 중요하게 의식해야 하기 때문
- DB의 기본적인 다중화 방식은 두 가지가 있음
  - Active-Active: 클러스터를 구성하는 컴포넌트를 동시에 가동. 시스템 다운 시간이 짧고, 성능도 좋아지지만 저장소가 병목되어 오히려 안 좋아 질 수도 있음
  - Active-Standby: 클러스터를 구성하는 컴포넌트 중 실제 가동하는 것은 Active, 남은 것은 대기(Standby)하고 있는다. HeartBeat 신호를 통해 Active의 생사여부를 체크하기 때문에 다운 시간이 길어질 수도 있음. Hot-Standby를 통해 빠르게 전환할 수도 있지만 라이선스료가 높게 되어있음


## DB 서버 다중화 - 리플리케이션

- 위 클러스터 구성은 서버 부분을 다중화 할 수 있지만 저장소는 다중화 할 수 없어 저장소가 부서질 경우 데이터를 일게 됨
- 리플리케이션 기술을 활용하면 저장소도 다중화 처리 가능
- Active 측 저장소의 데이터는 항상 갱신되기 때문에 Standby 측에 최신화 하지 않으면 정합성이 어긋날 수 있기에, 적절한 시간대를 통해 복제를 시도해야함

## Shared Nothing

- 복수의 서버가 1대의 디스크를 사용하는 구성을 `Shared Disk`라고 함. 이 타입은 Active-Active 구성을 무한으로 늘려도 처리율이 향상되지 않고 한계점에 도달하게 됨. 이를 해결하기 위한 아키텍처로 고안된 것이 `Shared Nothing (구글에선 개발한 것은 샤딩이라고함)`이라고 함.
- '아무것도 공유하지 않는다'는 의미로 네트워크 이외의 자원을 모두 분리하는 방식. 서버와 저장소의 세트를 늘리면 병렬처리 되기에 선형적인 성능향상 가능
- 저장소를 공유하지 않기에 각각 DB서버가 동일한 1개의 데이터에 액세스할 수 없기 때문에 정리 서버가 필요함.
- 그리고 DB 서버 하나 다운되면 그쪽의 데이터는 액세스 할 수 없음. (커버링 구성 필요)

> 적절한 아키텍처 구조를 구성하는 것이 가장 중요하다.