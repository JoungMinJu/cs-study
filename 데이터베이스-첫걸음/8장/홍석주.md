# 테이블 설계의 기초

- 관계형 데이터에서 데이터를 관리하고 저장하기 위한 그릇은 `테이블`이기에 이 테이블을 잘 설계하는 것이 매우 중요.
- 관계형 데이터베이스가 표준 데이터베이스 제품이 된 이유는 데이터의 정합성을 높이기 위한 `설계 노하우`가 매우 발달했기 때문임
  - 정규형
  - ER 다이어그램
- 테이블은 2차원 표 형태 처럼 열과 행으로 구성되어있음. 이때 데이터는 공통적인 요소의 집합으로 구성되어져 있어야 한다.

## 테이블 구성의 예

### BAD EXAMPLE

행 사이에 공통적인 요소가 존재하지 않음

|열1|열2|열3|열4|
|--|--|--|--|
|오늘 저녁 반찬|술|배추|파|
|이모씨|박모씨|김모씨|최모씨|
|보너스|플레이스테이션4|제주도|온천|
|남동생|080-0000-1111|OO시 XX구 OO동|1000원 대출|

### GOOD EXAMPLE

공통적인 특징을 가진 데이터의 집합

|원자번호|원소기호|원소명|
|--|--|--|
|1|H|수소|
|2|He|헬륨|
|3|Li|리튬|
|4|Be|베릴륨|

## PK (Primary Key의 존재)

> 테이블에 밑줄 그어진 칼럼이 PK를 의미한다.

- 테이블의 각 행에는 `반드시 기본키를 설정할 것`이라는 설계 원칙이 있음
- 이를 통해 중복 행을 허용하지 않게 함
- 기본키는 중복이 없고 변경이 안되는 컬럼을 지정해야 한다. 변경하면 아래의 문제 소지 발생
  - 변경 후 값의 유일성 보증할 수 없음
  - 과거 데이터와의 결합(매칭)이 어려움
- 기본키는 NULL이 들어갈 수 없다

## 정규형 (Normal Form)

- 테이블은 본인의 기준에 따라 열을 정의하고 테이블을 나눌 수 있는데, 이 상태가 지속되면 설계자 외에 알아볼 수 없는 테이블이 될 수도 있음
- 이런 사태를 줄이기 위해 `테이블은 이렇게 정의해야 한다`는 이론이 구축되었고 이것이 정규형이다.
- 정규형은 제1정규형부터 제5정규형까지 있는데 실무에서는 제3정규형까지만 알아도 충분함

### 제1정규형(1NF)

- 레코드의 단일성의 보증한다.
- 테이블 셀이 복합적인 값을 포함하지 않는다.
  - 복합적인 값은 배열 같은 값이 있음
- BEFORE

> 안석환의 과목은 두 개가 나열되어 있어서 1정규화가 필요하다.

|__사원ID__|이름|과목|
|--|--|--|
|S001|홍석주|DB|
|S002|이건회|자바|
|S003|안석환|(스프링, 자바스크립트)|

- AFTER

정규화를 통해 원자성을 맞춰준다.

|__사원ID__|이름|과목|
|--|--|--|
|S001|홍석주|DB|
|S002|이건회|자바|
|S003|안석환|스프링|
|S003|안석환|자바스크립트|

> 1정규형을 했지만, 갱신 이상이 발생할 수 있음

### 테이블은 함수다

- 왜 복합적인 값을 셀에 넣으면 안 되는가
- 복합적인 값을 허용하면 기본키가 있는 행의 값을 고유하게 특정할 수 없음
- 관계형 데이터베이스의 테이블은 기본키를 `입력 값 X`, 그 외 열 값을 `출력 값 Y`로 간주하는 `입력 값과 출력 값의 대응표`이다.
- 기본키와 다른 열 사이에 성립하는 함수적인 유일성을 관계형 데이터베이스에서는 `함수 종속성(Functional Dependency)`라고 함 {X} -> Y 형태로 표현 함
- 이렇 듯 복합적인 값인 경우에는 함수 종속성이 성립하지 않게 되기에 정규화를 해야함

### 제2정규형(2NF)

- 제1정규형을 만족한 상황에서 진행

- EXAMPLE

- BEFORE

고객기업과 주몬번호가 PK로 되어있는 상황

|__고객기업 ID__|__주문번호__|주문접수일|고객기업명|고객기업 규모|
|--|--|--|--|--|
|CA|001|2023/07/15|A 상사|대규모|
|CA|002|2023/07/16|A 상사|대규모|
|CB|001|2023/07/23|B 건설|중규모|
|CB|002|2023/07/24|B 건설|중규모|
|CC|001|2023/07/25|C 화학|소규모|

- 제1정규형을 충족하고 있으나, `부분함수 종속성`이 발생
- 부분함수 종속성은 `기본키를 구성하는 열의 일부에만 함수 종속이 존재`
- {고객기업 ID} -> {고객 기업명}, {고객기업 ID} -> {고객 규모}를 알 수 있음
- 위와 같은 부분함수 종속이 존재하면 해당 키와 종속하는 열을 다른 테이블로 만들어 외부로 꺼내야 한다.
- 또한, B 건설의 이름을 바꾸고자 하다가 (CB, 002)의 수정을 누락하면 `갱신 이상`이 발생할 수 있음

- AFTER

|__고객기업 ID__|__주문번호__|주문접수일|
|--|--|--|
|CA|001|2023/07/15|
|CA|002|2023/07/16|
|CB|001|2023/07/23|
|CB|002|2023/07/24|
|CC|001|2023/07/25|

|__고객기업 ID__|고객기업명|고객기업 규모|
|--|--|--|
|CA|A 상사|대규모|
|CB|B 건설|중규모|
|CC|C 화학|소규모|

### 제3정규형(3NF)

- 아래 테이블에서 업계만 등록하고 싶은데 그럴려면 회사 하나가 필요한 상황
  - NULL로 넣을 수 있겠지만 바람직하지 않음
- 제2정규형은 만족했으나, `추이함수 종속` 발생. 추이 함수도 테이블을 나누어야 함
  - {고객기업 ID} -> {업계 코드} -> {업계명}

- BEFORE

|__고객기업 ID__|고객기업명|고객기업규모|업계코드|업계명|
|--|--|--|--|--|
|CA|A상사|대규모|D001|석유|
|CB|B건설|중규모|D002|건설|
|CC|C화학|소규모|D003|바이오|

- AFTER

아래처럼 분리하면 따로 따로 원하는 데이터를 넣어도 문제 없다.

|__고객기업 ID__|고객기업명|고객기업규모|업계코드(FK)|
|--|--|--|--|
|CA|A상사|대규모|D001|
|CB|B건설|중규모|D002|
|CC|C화학|소규모|D003|

|업계코드|업계명|
|--|--|
|D001|석유|
|D002|건설|
|D003|바이오|